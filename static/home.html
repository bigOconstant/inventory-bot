<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="common.css">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
<style>



table {
  
  border-collapse: collapse;
  width: 100%;
  margin-bottom: 30px;
}


td, th {
  border: 1px solid #dddddd;
  text-align: left;
  padding: 8px;
}

tr:nth-child(even) {
  background-color: #dddddd;
}

.five {
  width: 5%;
}

</style>
<title >Admin</title>
</head>
  <body >

    <div class="topnav">
      <a class="active" href="#home">Home</a>
      <a href="/add" >Add Item</a>
      <a href="/about">About</a>
      <a class="settings" href="/settings">&#9881;</a>
    </div> 
  
  <div id="container">
    
    <h1>Monitored Inventory</h1>

  
  {{if .Data }} 
  {{if .Enabled}}
  <table id="tab">
    <tr>
      
      <th>Name</th>
      <th colspan="2" >In Stock</th>
      
    </tr>
  
     {{range .Data}}
     <tr>
       <td>
         <a href="{{.Url}}"> {{.Name}} <a></a>
       </td>
       <td class="five">
        <p style="float:left;">{{if not .InStock}}
        No
        {{else}}
        Yes
        {{end}}
          </p>
       </td>
       <td class="five">
        <form action="/" method="post" id="form{{.Id}}">
          <input type="hidden" id="form{{.Id}}" name="{{.Id}}" value="{{.Id}}"> 
          </form>
          <button title="delete" style="float:right;" type="submit" form="form{{.Id}}" value="Submit">&#8722;</button>
       </td>
      
      
    </tr>
    {{end}}
    {{end}}
  </table>
  {{if .Enabled}}
  <div class="info">
    {{.TimeInterval}} Second Refresh Interval
  </div>
  {{else}}
  <div class="info">
    Monitoring Disabled. Enable in settings.
  </div>
  {{end}}

  {{else}} 
  <p id="noneFoundMessage" style="text-align:center;color:red">No Items Found. Add some url's to settings.json or add a item in the nav bar</p>
  {{end}}

   
  </div>
  
  <img src="/favicon.ico">
  <div id="footer">Caleb McCarthy 2021.</div>
</body>

</html>


<script>
function SetTableDisplay(bool){
  if (bool) {
    table = document.getElementById("tab");
    table.style.display = "table"
    document.getElementById("noneFoundMessage").style.display = "none";
  }else{
    table = document.getElementById("tab");
    table.style.display = "none"
    document.getElementById("noneFoundMessage").style.display = "inline";
  }
}

let tableData = {data:JSON.parse('{{.DataJson}}')}


function ClearTable() {
    var myTable = document.getElementById('tab');
    var rowCount = myTable.rows.length; 
    while(--rowCount) myTable.deleteRow(rowCount);
}



function compareTwo(oldTable,newTable){
  if(!oldTable.data || !newTable.data|| oldTable.data.length !== newTable.data.length){
    return true;
  }
  oldTable.data.sort();
  newTable.data.sort();
  for (i = 0;i < oldTable.data.length; ++i){
    if(oldTable.data[i].instock != newTable.data[i].instock){
      return true
    }
  }
  return false
}

function UpdateTable(){
  fetch(window.location.href+'/api/items')
    .then(response => response.json())
    .then(data => {
      if(compareTwo(tableData,data)){
        location.reload();
      }
    });
    setTimeout(UpdateTable, 2000);
  }
  
UpdateTable();

</script>